digraph ML_Lib_Architecture {
    rankdir=TB;
    node [shape=box, style=filled, fillcolor="#f0f0f0", fontname="Arial"];
    edge [fontname="Arial"];
    
    // Main components
    subgraph cluster_kernel {
        label="Linux Kernel";
        style=filled;
        fillcolor="#e6f3ff";
        
        subgraph cluster_lib {
            label="lib/ml-lib/";
            style=filled;
            fillcolor="#ffffff";
            
            ml_lib_core [label="ML Library Core\n(ml_lib.h, ml_lib.c)", fillcolor="#d4edda"];
            ml_lib_model [label="ML Model Framework\n(ml_lib_model.h, ml_lib_model.c)", fillcolor="#d4edda"];
            ml_lib_dataset [label="Dataset Management\n(ml_lib_dataset.h, ml_lib_dataset.c)", fillcolor="#d4edda"];
        }
        
        subgraph cluster_test {
            label="Test Driver";
            style=filled;
            fillcolor="#ffffff";
            
            test_driver [label="Character Device Driver\n(ml_lib_char_dev.c)", fillcolor="#fff3cd"];
            sysfs_proc [label="Sysfs/Procfs Interface", fillcolor="#fff3cd"];
        }
    }
    
    // External components
    userspace [label="Userspace Applications", fillcolor="#e2e3e5"];
    hardware [label="AI Hardware (NPUs/TPUs)", fillcolor="#e2e3e5"];
    
    // Connections
    userspace -> test_driver [label="ioctl(), read(), write()"];
    test_driver -> ml_lib_core [label="API calls"];
    ml_lib_core -> ml_lib_model [label="Model management"];
    ml_lib_core -> ml_lib_dataset [label="Dataset operations"];
    ml_lib_model -> hardware [label="Hardware acceleration\n(optional)"];
    test_driver -> sysfs_proc [label="Debug/monitoring"];
}